# 高德地图API配置说明

## 功能说明

已实现地图选择功能，点击"地图选择"按钮可以：
1. 在地图上点击选择位置
2. 搜索地点并定位
3. 自动获取地址、经纬度和省份信息
4. 支持标记拖拽调整位置

## 配置步骤

### 方法一：使用环境变量（推荐）

1. 在高德开放平台注册并创建应用
   - 访问：https://lbs.amap.com/
   - 注册账号并登录控制台
   - 创建新应用或选择已有应用
   - 点击"添加Key"

2. **选择服务平台**
   - ✅ **选择"Web端(JS API)"** ← 这是前端地图组件需要的
   - 填写Key名称（如：gd）
   - 域名白名单（开发环境可留空，生产环境填写实际域名）
   - 勾选同意协议并提交

3. 获取Key后，在 `travel-admin` 项目根目录创建或编辑 `.env` 文件：
   ```env
   # 高德地图API Key
   VITE_AMAP_KEY=你的高德地图JS_API_Key
   # 高德地图安全密钥（可选，但推荐配置以避免INVALID_USER_SCODE错误）
   VITE_AMAP_SECURITY_CODE=你的安全密钥
   ```
   
   从你的截图可以看到：
   - Key: `4c1487f8f9b1c39bb406fdf78c214c76`
   - 安全密钥: `52c877fe4df5a628992e4063df3577ae`

4. 完整配置示例：
   ```env
   VITE_AMAP_KEY=4c1487f8f9b1c39bb406fdf78c214c76
   VITE_AMAP_SECURITY_CODE=52c877fe4df5a628992e4063df3577ae
   ```

5. 重启前端开发服务器

**注意**：
- 安全密钥可以防止Key被滥用，建议配置
- 如果出现 `INVALID_USER_SCODE` 错误，说明需要配置安全密钥
- 后端的地理编码API使用独立的Key（在 `application-dev.yml` 中配置 `third-party.amap.api.key`），与前端JS API Key分开管理

### 方法二：使用系统配置（可选）

也可以通过后端系统配置接口设置：
- API路径：`/api/system-config/set`
- 参数：`configKey=amap.api.key`, `configValue=你的API_Key`

## API Key权限配置

在高德开放平台的应用管理中，需要启用以下服务：
- ✅ Web服务API（用于地理编码、逆地理编码、输入提示）
- ✅ Web端(JS API)（用于地图显示和交互）

## 注意事项

1. API Key需要在浏览器端使用，建议设置域名白名单（可选）
2. 免费版有调用次数限制，建议监控使用量
3. 如果未配置API Key，地图选择功能会提示错误

## 使用说明

1. 点击"地图选择"按钮打开地图对话框
2. 可以：
   - 直接在地图上点击选择位置
   - 使用搜索框搜索地点
   - 拖拽标记调整位置
3. 选择后点击"确定"按钮，地址和坐标会自动填充到表单中

